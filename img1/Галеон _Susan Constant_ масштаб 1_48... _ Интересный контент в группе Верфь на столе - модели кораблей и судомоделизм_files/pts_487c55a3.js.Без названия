define(["module","OK/logger","OK/utils/vanilla","OK/PackageRegistry"],(function(e,t,n,r){"use strict";var s,i={},u=[],o={},a="$Hash$",c=e.config().timeout||3e5;function h(e){return i.hasOwnProperty(e)}function f(e){var t=i[e];return t&&0!==Object.keys(t).length||!OK.fn.isDebug()||console.error('Пакет "'+e+'" отсутствует. Наверно, не удалось загрузить'),i[e]}function g(e,t){return i[e]=new l(e,t),function(e){for(var t=o[e]||[],n=t.length;n--;)t[n]()}(e),f(e)}function l(e,t){this.pkg=e,this.messages=t,this.parsedResources={}}function p(e){this.text=e}function d(e){this.argName=e}function v(e,t){this.argName=e,this.values=t}function w(e,t){this.argName=e,this.values=t}function m(e){return(e=Math.abs(e))%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2}function k(e){return 1===e?0:1}function b(e){return 0}l.prototype={has:function(e){return this.messages.hasOwnProperty(e)},getLMsg:function(e,n){if(!e&&!n)return this.messages;var r=this.messages&&this.messages[e];if("string"!=typeof r)return t.success("pts.miss",this.pkg,e),this.pkg+"."+e;if(n){var s=this.parsedResources[e];return s||(s=function(e){for(var t=[],n=0;;){var r=R(t,e,n);if(r===e.length)break;n===r&&r++,n=r}return O(t)}(r),this.parsedResources[e]=s),s.getResource(n)}return r},subscribe:function(e){var t=this.pkg;o[t]||(o[t]=[]),o[t].push(e)}},p.prototype.getResource=function(){return n.unescapeXml(n.encodeHtml(this.text))},d.prototype.getResource=function(e){var t=e[this.argName];return t||0===t?t:""},v.prototype.getResource=function(e){var t=e[this.argName],n=t;"Plural"===this.argName.substr(-6)&&(n=y.getIndex(t));var r=this.values[n];return r?r.getResource(e):""},w.prototype.getResource=function(e){var t=e[this.argName],n=this.values[t];return n?n.getResource(e):""};var y={ru:m,uk:m,en:k,hy:k,mo:k,ro:k,de:k,uz:b,az:b,kk:b,ka:b,ky:b,tg:b,tr:b,getIndex:function(e){var t=document.body.parentElement.getAttribute("lang"),n=y[t];return n||(n=m),n(e)}};function P(e){this.children=e}function R(e,t,n){var r,s;if(-1===(r=N(t,n,"|[]")))return-1===(r=N(t,n,"]"))?(e.push(new p(t.substr(n))),t.length):(e.push(new p(t.substr(n,r-n))),r);if(r>n)return e.push(new p(t.substr(n,r-n))),r;if("["===t[r]){if(-1===(r=N(t,n=r+1,":?]")))return n--,e.push(new p(t.substr(n))),t.length;var i=(s=t.substr(n,r-n))?s.replace(/^\s+|\s+$/gm,""):"";if("]"===t[r])return e.push(new d(i)),r+1;var u=t[r],o="?"===u,a=o?{}:[];if("?"!==u&&":"!==u)return r=N(t,n,"]"),e.push(new p(t.substr(n-1,r))),t.length;for(;;){n=r+1;var c,h=[];if(o){if(!((r=N(t,n,"="))>n))return r=N(t,n,"]"),e.push(new p(t.substr(n,r))),t.length;c=t.substr(n,r-n),n=r+1}for(;(r=R(h,t,n))!==t.length&&("|"!==t[r]&&"]"!==t[r]);)n==r&&r++,n=r;if(o?a[c]=O(h):a.push(O(h)),r===t.length||"]"===t[r])break}return o?e.push(new w(i,a)):e.push(new v(i,a)),r===t.length?t.length:r+1}return r}function O(e){return 0===e.length?new p(""):1===e.length?e[0]:new P(e)}function N(e,t,n){for(var r=t;r<e.length;r++)for(var s=0;s<n.length;s++)if(n[s]===e[r])return r;return-1}function j(){for(var e,t=[],n=0,r=u.length;n<r;n+=1){var s=f(e=u[n]);t.push({pkg:e,hash:s&&s.messages[a]||"0"})}return JSON.stringify(t)}function x(){n.ajax({url:"/web-api/upts",headers:{"Content-Type":"application/json"},data:j(),dataType:"json"}).then((function(e){for(var t,n=e.response,r=Object.keys(n),s=0,i=r.length;s<i;s+=1)g(t=r[s],n[t])}))}function _(e){e&&(-1===u.indexOf(e)&&u.push(e),!s&&c>0&&(s=window.setInterval(x,c)))}if(P.prototype.getResource=function(e){for(var t="",n=0;n<this.children.length;n++)t+=this.children[n].getResource(e);return t},"undefined"!=typeof window&&(window.l10n={getPkg:function(e){return _(e),f(e)}},void 0!==window.inline_resources&&void 0!==window.inline_resources.pts)){for(var K in window.inline_resources.pts)g(K,window.inline_resources.pts[K]),_(K);window.inline_resources.pts={}}return{load:function(e,t,n,s){if(s.isBuild)n();else{var i=e.split(","),u=i.filter((function(e){return!h(e)&&!r.hasPackagePromise(e)}));u.sort(),u.forEach((function(e){r.addPackagePromise(e)})),u.length>0&&t(["PTS/"+u.join(",")],(function(e){u.forEach((function(t){g(t,e[t]),r.getPackageResolve(t)(f(t)),r.deallocatePackage(t)}))})),Promise.all(i.map((function(e){return h(e)?f(e):r.getPackagePromise(e)}))).then((function(e){1===e.length&&(e=e[0]),n(e)}))}}}}));
//# sourceMappingURL=/res/source-maps/js/app/pts.js.map