define(["module","OK/utils/vanilla","OK/logger"],(function(n,e,o){"use strict";var i,r={},t=[],a={},s="$Hash$",u=n.config().timeout||6e4;function d(n){var e=r[n];return e&&e.data||{}}function c(n,e){var i={data:{}};return e&&e.data?i.data=JSON.parse(e.data):(console.warn("Error while loading PMS config: ",n),o.error("pms","Config was not loaded",n)),i[s]=e[s],r[n]=i,function(n){for(var e=a[n]||[],o=e.length;o--;)e[o]()}(n),d(n)}function f(){for(var n,e,o=[],i=0,a=t.length;i<a;i+=1)n=t[i],e=r[n],o.push({alias:n,hash:e[s]||"0"});return JSON.stringify(o)}function p(){e.ajax({url:"/web-api/upms",headers:{"Content-Type":"application/json"},data:f(),dataType:"json"}).then((function(n){for(var e,o=n.response,i=Object.keys(o),r=0,t=i.length;r<t;r+=1)c(e=i[r],o[e])}))}function l(n){n&&(-1===t.indexOf(n)&&t.push(n),!i&&u>0&&(i=window.setInterval(p,u)))}if("undefined"!=typeof window&&(window.cfgStore={getCfg:function(n){return l(n),d(n)},subscribe:function(n,e){a[n]||(a[n]=[]),a[n].push(e)}},void 0!==window.inline_resources&&void 0!==window.inline_resources.pms)){for(var w in window.inline_resources.pms)c(w,window.inline_resources.pms[w]),l(w);window.inline_resources.pms={}}return{load:function(n,o,i,t){t.isBuild?i():!function(n){return r.hasOwnProperty(n)}(n)?function(n){return e.ajax({type:"GET",url:"/web-api/pms?name="+encodeURIComponent(n),headers:{"Content-Type":"application/json"},dataType:"json"}).then((function(n){return Promise.resolve(n.response)}))}(n).then((function(e){i(c(n,e))})):i(d(n))}}}));
//# sourceMappingURL=/res/source-maps/js/app/pms.js.map