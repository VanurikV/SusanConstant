define("OK/AbstractShortcutMenu",["OK/utils/dom","OK/utils/vanilla","OK/utils/delegate"],(function(e,t,i){"use strict";var s="ShortcutMenu",n=null,o=document.createElement("div");function h(){this.holder=null,this.menuElement=null,this.showTimeout=null,this.hideTimeout=null,this.ajaxRequest=null,this.direction="",this.position="center",this._visible=!1,this.cancelShow=!1,this.inplace=!1,this.detectScrollableContainer=!1,this.menuElementHoverInListenerCalled=!1,this.proxiedEvents=null,this.activateTime=0,this.ignoreHoverTime=-1}return o.id="hook_Block_"+s,document.body.appendChild(o),OK.hookModel.captureBlockHook("body",o),o.addEventListener("change",(function(){n&&n.visible()&&n.positingElement()})),h.getActiveInstance=function(){return n},h.setActiveInstance=function(e){n=e},h.getBlockId=function(){return s},h.prototype.getBlock=function(){return this.inplace?this.block:o},h.prototype.getHtml=function(){},h.prototype.initListeners=function(e){if(this.shortcutMenuDelegate=new i(e),this.shortcutMenuDelegate.on("click",".sc-menu a",this.menuElementLinkClickListener.bind(this)),this.shortcutMenuDelegate.on("click",".sc-menu .js-hide",this.menuElementClickListener.bind(this)),this.shortcutMenuDelegate.on("click",".js-forceHide",function(e,t){this.hideMenu({forceHide:!t.classList.contains("js-supress-forceHide")})}.bind(this)),this.shortcutMenuDelegate.on("mouseenter",this.menuElementHoverInListener.bind(this)),this.shortcutMenuDelegate.on("mouseleave",this.hoverOutListener.bind(this)),OK.device.isTouch&&this.shortcutMenuDelegate.on("touchstart",this.holderTouchStartListener.bind(this)),this.proxiedEvents){var s=this;this.proxiedEvents.split(",").forEach((function(e){s.shortcutMenuDelegate.on(e,(function(){t.trigger(s.getHolder(),e),s.hideMenu()}))}))}},h.prototype.processHTML=function(i){var s=[];this.inplace?(this.initBlock(),s[0]=this.blockId):s[0]=h.getBlockId();var n=this.getBlock();t.updateBlocks(i,s),this.initListeners(n),this.menuElement=e.firstByClass(n,"sc-menu"),this.positingElement(),this.menuElement.classList.remove("sc-menu__hidden"),this.holder.classList.add("__vis"),h.setActiveInstance(this),this._visible=!0},h.prototype.showMenu=function(){clearTimeout(this.hideTimeout),this.showTimeout=null,this.visible()||(n&&n.hide(),this.processHTML(this.getHtml()),t.trigger(this.holder,"shortcut-menu-show"),this.hideOnScroll&&(this.oneScrollListener={element:this.getClosestScrollable(!0),type:"scroll",handler:this.hoverOutListener.bind(this)},this.oneScrollListener.element.addEventListener("scroll",this.oneScrollListener.handler)))},h.prototype.hideMenu=function(e){this.clearShowTimeout(),this.clearHideTimeout(),t.trigger(this.holder,"shortcut-menu-hide",e),this.menuElement&&(this.menuElement.classList.add("sc-menu__hidden"),OK.hookModel.setHookContent(s,""),this.menuElement=null),this.holder.classList.remove("__vis"),this.shortcutMenuDelegate&&this.shortcutMenuDelegate.off(),this._visible=!1,this.removeOneTimeListener(this.oneScrollListener),h.setActiveInstance(null)},h.prototype.hide=function(){this.clearShowTimeout(),this.clearHideTimeout(),this.menuElement?this.hideMenu():this.ajaxRequest&&(this.cacheable?this.cancelShow=!0:this.ajaxClose())},h.prototype.getClosestScrollable=function(t){if(!this.closestScrollable){var i=/(auto|scroll)/,s=e.traverseParents(this.holder,(function(e){var s=window.getComputedStyle(e);return i.test(s.overflow+s.overflowY+s.overflowX)&&(!t||e.scrollHeight>e.clientHeight)}));this.closestScrollable=s||window}return this.closestScrollable},h.prototype.isTopDirection=function(e,t){var i=this.holder.getBoundingClientRect().top;if(this.detectScrollableContainer){var s=this.holder.getBoundingClientRect().height,n=this.getClosestScrollable(),o=i-n.getBoundingClientRect().top,h=n.clientHeight-s,r=n.scrollTop+o+s+t,l=n.scrollHeight;return h/2<o||r>l}return window.innerHeight-e-i<t},h.prototype.isInsideViewportWhileCentered=function(e){var t=this.holder.getBoundingClientRect(),i=t.left,s=window.innerWidth-OK.scrollBar.width;if(this.detectScrollableContainer){var n=this.getClosestScrollable().getBoundingClientRect();i-=n.left,s=n.right}var o=i+(t.width-e)/2;return o>0&&o+e<s},h.prototype.toRightFromHolder=function(e,t){if(this.detectScrollableContainer){var i=this.getClosestScrollable().getBoundingClientRect(),s=this.holder.getBoundingClientRect().left-i.left;return i.width/2>s}return window.innerWidth-OK.scrollBar.width>e.left+t},h.prototype.visible=function(){return this._visible},h.prototype.getOffset=function(e){var t=e.getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset}},h.prototype.positingElement=function(){var t,i=e.outerSize(this.holder,!1,!1),s=this.inplace?{top:0,left:0}:this.getOffset(this.holder),n=e.outerSize(this.holder,!0,!1),o=e.outerSize(this.menuElement,!0,!0),h=this.position;"center"!==h||this.isInsideViewportWhileCentered(o)||(h="auto"),"center"!==h&&"auto"!==h&&this.menuElement.classList.add("__noarrow");var r=e.outerSize(this.menuElement,!1,!0);t="top_force"===this.direction||"bottom_force"===this.direction?"top_force"===this.direction:"top"===this.direction?this.getOffset(this.holder).top-window.pageYOffset-90>r:"bottom"!==this.direction&&this.isTopDirection(i,r);var l,a=s.top,u=[];t?(this.menuElement.classList.add("sc-menu__top"),this.inplace?(l=a+i,u.push("top: auto; bottom: "+Math.round(l)+"px;")):(a-=r,u.push("bottom: auto; top: "+Math.round(a)+"px;"))):(this.menuElement.classList.remove("sc-menu__top"),this.inplace||(a+=i),u.push("bottom: auto; top: "+Math.round(a)+"px;"));var c=Math.round(s.left-(o-n)),d=Math.round(s.left),m=Math.round(s.left+(n-o)/2);switch(h){case"left":u.push("left: "+c+"px;");break;case"right":u.push("left: "+d+"px;");break;case"auto":var p=e.firstByClass(this.menuElement,"entity-shortcut-menu_arw"),g=0,f=p?54:0,v=this.toRightFromHolder(s,o);if(v?(this.menuElement.classList.remove("__right"),this.menuElement.classList.add("__left")):(this.menuElement.classList.add("__right"),this.menuElement.classList.remove("__left")),!f&&(p=e.firstByClass(this.menuElement,"sc-menu_arw"))){var b=p.getBoundingClientRect();if(b.width){var w=this.menuElement.getBoundingClientRect();f=v?2*(b.left-w.left)+b.width:2*(w.left+w.width-(b.left+b.width))+b.width}}n<f&&(g=(f-n)/2),v?u.push("left: "+(d-g)+"px;"):u.push("left: "+(c+g)+"px;");break;default:u.push("left: "+m+"px;")}this.menuElement.setAttribute("style",u.join(""))},h.prototype.ajaxClose=function(e){this.ajaxRequest&&(this.ajaxRequest.xhr.abort(),this.ajaxRequest=null,this.cancelShow=!1,"function"==typeof e&&e())},h.prototype.hoverInListener=function(e){(OK.device.isTouch||Date.now()-this.activateTime<=this.ignoreHoverTime)&&e||(n!==this&&(n||h.setActiveInstance(this)),this.clearHideTimeout(),this.showTimeout||this.visible()||(this.showTimeout=setTimeout(this.showMenu.bind(this),this.showDelay)))},h.prototype.hoverOutListener=function(){this.clearShowTimeout(),this.ajaxClose(),!this.hideTimeout&&this.visible()&&(this.hideTimeout=setTimeout(function(){this.hideOnBlurElement!==document.activeElement?this.hideMenu():this.hideTimeout=null}.bind(this),this.hideDelay))},h.prototype.menuElementHoverInListener=function(){this.menuElementHoverInListenerCalled=!0,this.hideTimeout&&(this.hideTimeout=clearTimeout(this.hideTimeout))},h.prototype.menuElementLinkClickListener=function(t){e.parent(t.target,"js-doNotHide",this.block)||this.menuElementClickListener()},h.prototype.menuElementClickListener=function(){!0===this.hideTimeout&&(this.hideTimeout=null),this.hoverOutListener()},h.prototype.holderTouchStartListener=function(e){e.stopPropagation()},h.prototype.clearShowTimeout=function(){this.showTimeout&&(this.showTimeout=clearTimeout(this.showTimeout))},h.prototype.clearHideTimeout=function(){this.hideTimeout&&(this.hideTimeout=clearTimeout(this.hideTimeout))},h.prototype.removeOneTimeListener=function(e){e&&(e.element.removeEventListener(e.type,e.handler),e=null)},h})),define("OK/pms",["module","OK/utils/vanilla","OK/logger"],(function(e,t,i){"use strict";var s,n={},o=[],h={},r="$Hash$",l=e.config().timeout||6e4;function a(e){var t=n[e];return t&&t.data||{}}function u(e,t){var s={data:{}};return t&&t.data?s.data=JSON.parse(t.data):(console.warn("Error while loading PMS config: ",e),i.error("pms","Config was not loaded",e)),s[r]=t[r],n[e]=s,function(e){for(var t=h[e]||[],i=t.length;i--;)t[i]()}(e),a(e)}function c(){for(var e,t,i=[],s=0,h=o.length;s<h;s+=1)e=o[s],t=n[e],i.push({alias:e,hash:t[r]||"0"});return JSON.stringify(i)}function d(){t.ajax({url:"/web-api/upms",headers:{"Content-Type":"application/json"},data:c(),dataType:"json"}).then((function(e){for(var t,i=e.response,s=Object.keys(i),n=0,o=s.length;n<o;n+=1)u(t=s[n],i[t])}))}function m(e){e&&(-1===o.indexOf(e)&&o.push(e),!s&&l>0&&(s=window.setInterval(d,l)))}if("undefined"!=typeof window&&(window.cfgStore={getCfg:function(e){return m(e),a(e)},subscribe:function(e,t){h[e]||(h[e]=[]),h[e].push(t)}},void 0!==window.inline_resources&&void 0!==window.inline_resources.pms)){for(var p in window.inline_resources.pms)u(p,window.inline_resources.pms[p]),m(p);window.inline_resources.pms={}}return{load:function(e,i,s,o){o.isBuild?s():!function(e){return n.hasOwnProperty(e)}(e)?function(e){return t.ajax({type:"GET",url:"/web-api/pms?name="+encodeURIComponent(e),headers:{"Content-Type":"application/json"},dataType:"json"}).then((function(e){return Promise.resolve(e.response)}))}(e).then((function(t){s(u(e,t))})):s(a(e))}}})),define("OK/ShortcutMenu",["OK/logger","OK/utils/vanilla","OK/utils/dom","OK/utils/delegate","OK/AbstractShortcutMenu","OK/pms!accessibilityConfiguration"],(function(e,t,i,s,n,o){"use strict";var h=Boolean(o&&o.areAccessibleDropDownMenusEnabled);function r(e){n.call(this),this.hookId=e,this.stopClick=!0,this.ajaxRequest=null,this.cacheable=!0,this.loaded=!1,this.showOnClick=!0,this.showOnHover=!1}r.prototype=Object.create(n.prototype),r.prototype.constructor=r;return Object.assign(r.prototype,{activate:function(t){var n=parseInt(t.getAttribute("data-ignoreHoverTime"),10);if(this.element=t,this.holder=this.getHolder(),this.blockId=this.element.getAttribute("data-blockid"),this.block=document.getElementById("hook_Block_"+this.blockId),this.inplace=this.element.getAttribute("data-inplace"),this.loaded=this.element.getAttribute("data-loaded"),this.showDelay=parseInt(this.element.getAttribute("data-show"),10)||300,this.hideDelay=parseInt(this.element.getAttribute("data-hide"),10)||100,this.cacheable=!this.element.getAttribute("data-nocache"),this.saveChanges=this.element.getAttribute("data-save-changes"),this.direction=this.element.getAttribute("data-direction"),this.position=this.element.getAttribute("data-position")||"center",this.showOnClick=this.element.getAttribute("data-onClick"),this.showOnHover=this.element.getAttribute("data-onHover"),this.isShowImmediately=this.element.getAttribute("data-showImmediately"),this.showImmediatelySelector=this.element.getAttribute("data-showImmediatelySelector"),this.relatedMenu=this.getRelatedMenu(),this.hideOnClick=this.element.getAttribute("data-hideOnClick"),this.hideOnMouseDown=this.element.getAttribute("data-hideOnMouseDown"),this.hideOnScroll=this.element.getAttribute("data-hideOnScroll"),this.hideOnBlurSelector=this.element.getAttribute("data-hideOnBlurSelector"),this.hideOnBlurElement=null,this.menuName=this.element.getAttribute("data-menuName"),this.withA11yAttr=this.holder.hasAttribute("aria-expanded"),this.detectScrollableContainer=this.element.getAttribute("data-detect-scrollable"),this.proxiedEvents=t.getAttribute("data-proxied-events"),isNaN(n)||(this.ignoreHoverTime=n),!this.holder)return e.error("asm","noholder"),void e.success("asm","noholder",this.buildParamFingerprint());if(this.handlers={},this.boundAjaxFail=this.ajaxFail.bind(this),this.boundAjaxDone=this.ajaxDone.bind(this),this.showMenu=this.showMenu.bind(this),this.toggleMenuOnKeyPress=this.toggleMenuOnKeyPress.bind(this),this.toggleAriaExpanded=this.toggleAriaExpanded.bind(this),this.holderDelegate=new s(this.holder),OK.device.isTouch){this.holderDelegate.on("touchstart",this.holderTouchStartListener);var o=this.holder.getElementsByTagName("a")[0];o||(o=i.traverseParents(this.holder,(function(e){return"A"===e.tagName.toUpperCase()}),document.body,!0)),o&&(this.linkDelegate=new s(o),this.linkDelegate.on("touchstart",this.touchHandle.bind(this),!0))}this.holderDelegate.on("mouseleave",this.hoverOutListener.bind(this)),!this.showOnHover&&this.showOnClick||this.holderDelegate.on("mouseenter",this.hoverInListener.bind(this)),this.showOnClick?(this.oneClickListener=this.addOneTimeListener(this.holder,"click",this.showMenu),this.oneKeyPressListener=this.addOneTimeListener(this.holder,"keypress",this.toggleMenuOnKeyPress)):(this.hideOnClick&&this.holderDelegate.on("click",this.hoverOutListener.bind(this)),this.hideOnMouseDown&&this.holderDelegate.on("mousedown",this.hoverOutListener.bind(this))),this.inplace&&this.loaded&&this.initListeners(this.getBlock()),this.isShowImmediately&&this.showImmediately(),"1"===t.getAttribute("data-expanded")&&setTimeout(this.showMenu,0),this.activateTime=Date.now()},deactivate:function(){this.holder&&(this.ajaxClose(),this.hide(),this.removeOneTimeListener(this.oneClickListener),this.removeOneTimeListener(this.oneKeyPressListener),this.removeOneTimeListener(this.oneScrollListener),this.removeOneTimeListener(this.oneBodyTouchListener),this.removeOneTimeListener(this.oneImmediatelyHandler),this.removeOneTimeListener(this.oneBlurListener),this.holderDelegate.destroy(),this.linkDelegate&&this.linkDelegate.destroy(),this.shortcutMenuDelegate&&this.shortcutMenuDelegate.destroy())},buildParamFingerprint:function(){var e=[this.inplace,this.loaded,this.cacheable,this.showOnClick,this.hideOnClick,this.hideOnScroll],t="";return e.forEach((function(e){t+=(1*!!e).toString()})),t},getHolder:function(){var e=this.element.getAttribute("data-holder");return e?document.getElementById(e):this.element.previousElementSibling},getRelatedMenu:function(){var e,t=this.element.getAttribute("data-related");return t&&(e=OK.hookModel.getHookById(t))&&e.getInstance?e.getInstance():null},getHtml:function(){if(!this.block)return"";var e=this.block.innerHTML;return this.inplace&&this.cacheable||(OK.hookModel.setHookContent(this.blockId,""),this.cacheable&&(this.block.innerHTML=e)),e},initBlock:function(){if(this.element&&!this.block){for(var e=Array.prototype.slice.call(this.element.children),t=null,i=0;i<e.length;i++)if(e[i].classList.contains("posR")){t=e[i];break}if(t)this.block=t;else{var s=document.createElement("div");s.id="hook_Block_"+this.blockId,s.className="posR",this.element.appendChild(s),this.block=s,OK.hookModel.captureBlockHook(this.hookId,s)}}},initListeners:function(e){n.prototype.initListeners.call(this,e),this.hideOnBlurSelector&&(this.hideOnBlurElement=this.block.querySelector(this.hideOnBlurSelector),this.oneBlurListener=this.addOneTimeListener(this.hideOnBlurElement,"blur",this.hoverOutListener.bind(this)))},showMenu:function(){if(clearTimeout(this.hideTimeout),this.showTimeout=null,this.relatedMenu&&this.relatedMenu.hide&&this.relatedMenu.hide(),!this.visible()&&(n.getActiveInstance()&&n.getActiveInstance().hide(),this.showOnClick&&(this.removeOneTimeListener(this.oneClickListener),this.removeOneTimeListener(this.oneKeyPressListener),this.oneClickListener=this.addOneTimeListener(this.holder,"click",this.hideMenu),this.oneKeyPressListener=this.addOneTimeListener(this.holder,"keypress",this.toggleMenuOnKeyPress)),this.hideOnScroll&&(this.oneScrollListener=this.addOneTimeListener(this.getClosestScrollable(!0),"scroll",this.hoverOutListener)),this.showTimeout=null,OK.device.isTouch&&(this.oneBodyTouchListener=this.addOneTimeListener(document.body,"touchstart",this.hoverOutListener)),!this.ajaxRequest))if(this.startTime=Date.now(),this.loaded){var i=this.getHtml();this.processHTML(i,void 0,!this.inplace||!this.cacheable);const t=this.menuName?"cache."+this.menuName:"cache";e.success("asm","show",t),this.toggleAriaExpanded(!0)}else{var s=this.element.getAttribute("data-url");this.ajaxRequest=t.ajax({url:s,dataType:"html"}),this.ajaxRequest.then(this.boundAjaxDone,this.boundAjaxFail)}},toggleMenuOnKeyPress:function(e){e.preventDefault(),13!==e.keyCode&&32!==e.keyCode||(this.visible()?this.hideMenu():this.showMenu())},showImmediately:function(){var e=this;e.showImmediatelySelector&&setTimeout((function(){var t=e.showImmediatelySelector+":hover";e.showImmediatelyElement=i.traverseParents(e.holder,(function(e){return e.matches(t)})),e.showImmediatelyElement.matches(t)&&(e.showMenu(),e.oneImmediatelyHandler=this.addOneTimeListener(e.showImmediatelyElement,"mouseleave",(function(){setTimeout((function(){e.menuElementHoverInListenerCalled||e.hideMenu()}),e.hideDelay)})))}),1)},hideMenu:function(){this.clearShowTimeout(),(this.visible()||this.showOnClick)&&(this.clearHideTimeout(),this.stopClick=!0,this.showOnClick&&(this.removeOneTimeListener(this.oneClickListener),this.removeOneTimeListener(this.oneKeyPressListener),this.oneClickListener=this.addOneTimeListener(this.holder,"click",this.showMenu),this.oneKeyPressListener=this.addOneTimeListener(this.holder,"keypress",this.toggleMenuOnKeyPress)),this.ajaxClose((function(){e.success("asm","ajax","to")})),this.toggleAriaExpanded(!1),this.menuElement&&(this.menuElement.classList.add("sc-menu__hidden"),this.getHtml(),this.saveChanges&&!this.inplace&&this.loaded&&this.cacheable&&(this.initBlock(),this.block.innerHTML=this.getBlock().innerHTML),OK.hookModel.setHookContent(n.getBlockId(),""),this.menuElement=null),this.holder.classList.remove("__vis"),t.trigger(this.holder,"sm:hide"),this.shortcutMenuDelegate&&!this.cacheable&&this.shortcutMenuDelegate.off(),this._visible=!1,h&&(this.holder.ariaExpanded="false"),n.setActiveInstance(null))},touchHandle:function(e){if(this.stopClick)return e.preventDefault(),e.stopPropagation(),this.stopClick=!1,this.showOnClick||this.hoverInListener(),!1;this.hoverOutListener()},processHTML:function(e,s,o){var r=[];s&&s.getResponseHeader(OK.navigation.HEADER)&&(r=s.getResponseHeader(OK.navigation.HEADER).split(",")),this.inplace?(this.initBlock(),r[0]=this.blockId):r[0]=n.getBlockId();var l=this.getBlock();o&&(t.updateBlocks(e,r),this.initListeners(l)),this.menuElement=i.firstByClass(l,"sc-menu"),this.positingElement(),this.menuElement.classList.remove("sc-menu__hidden"),this.holder.classList.add("__vis"),t.trigger(this.holder,"sm:show"),n.setActiveInstance(this),this._visible=!0,h&&(this.holder.ariaExpanded="true")},ajaxDone:function(t){e.duration("asm",Date.now()-this.startTime,"ajax");var i=t.response;if(!i||0===i.split(OK.navigation.SPLITER)[0].length)return void e.success("asm","ajax","e");this.toggleAriaExpanded(!0);const s=this.menuName?"ajax."+this.menuName:"ajax";e.success("asm","show",s),this.cacheable&&this.element&&(this.loaded=!0,this.initBlock(),this.block.innerHTML=i.split(OK.navigation.SPLITER)[0]),this.cancelShow||this.processHTML(i,t.xhr,!0),this.ajaxClose()},ajaxFail:function(){this.ajaxClose((function(){e.error("asm","ajax")}))},addOneTimeListener:function(e,t,i){var s=this,n=function t(n){e.removeEventListener(n.type,t),i.call(s,n)};return e.addEventListener(t,n),{element:e,type:t,handler:n}},removeOneTimeListener:function(e){e&&(e.element.removeEventListener(e.type,e.handler),e=null)},toggleAriaExpanded:function(e){this.withA11yAttr&&this.holder&&this.holder.setAttribute("aria-expanded",e)}}),r})),define("b/shortcutMenuBundle",["OK/AbstractShortcutMenu","OK/ShortcutMenu"],{});
//# sourceMappingURL=/res/source-maps/js/b/shortcutMenuBundle.js.map