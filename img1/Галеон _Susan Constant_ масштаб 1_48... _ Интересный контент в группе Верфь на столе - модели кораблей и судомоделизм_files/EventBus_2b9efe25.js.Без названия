define(["require","exports","OK/EventFactoryForEventBus"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EventBus=void 0;var n=function e(t){var n=this;this.listeners=new Map,this.emit=function(t,r){return void 0===r&&(r=null),e.emit({prefix:n.prefix,name:n.name,data:t,target:r})},this.on=function(t,r){var i=n.makeListener(t,r);return!!i&&(e.on(i),!0)},this.off=function(t){var r=n.listeners.get(t);r&&(e.off(r),n.listeners.delete(t))},this.isMe=function(e){return n.name===e.name&&n.prefix===e.prefix},this.makeListener=function(e,t){if(!n.listeners.has(e)){var r=n,i=function(n){var i=n.detail;if(!n.defaultPrevented&&r.isMe(i)&&(!t||!i.target||t!==i.target))return e(i.data)}.bind(n);return n.listeners.set(e,i),i}window.OK.logging.info("EventBus["+n.prefix+", "+n.name+"]: повторное добавление обработчика")},this.prefix=t.prefix,this.name=t.name};n.factory=function(e){return function(t){return n.create({prefix:e,name:t})}},e.EventBus=n,n.EVENT_NAME="okeventbus",n.eventHost=t.eventFactory.create(),n.registeredBuses=new Set,n.getRegisteredBuses=function(){return n.registeredBuses},n.getHost=function(){return n.eventHost},n.createEvent=function(e){return new CustomEvent(n.EVENT_NAME,{detail:e,bubbles:!1,cancelable:!0})},n.on=function(e){if(n.hasListener(e))throw new Error("EventBus: повторное добавление обработчика");n.eventHost.attach(e)},n.off=function(e){n.eventHost.detach(e)},n.emit=function(e){var t=n.createEvent(e);return n.eventHost.trigger(t),!t.defaultPrevented},n.findRegistered=function(e){var t=null;return n.registeredBuses.forEach((function(n){!t&&n.isMe(e)&&(t=n)})),t},n.create=function(e){return n.getInstance(e)},n.getInstance=function(e){var t=n.findRegistered(e);return t||(t=new n(e),n.getRegisteredBuses().add(t)),t},n.hasListener=function(e){return n.eventHost.list.some((function(t){return t.handler===e}))}}));
//# sourceMappingURL=/res/source-maps/js/app/EventBus.js.map