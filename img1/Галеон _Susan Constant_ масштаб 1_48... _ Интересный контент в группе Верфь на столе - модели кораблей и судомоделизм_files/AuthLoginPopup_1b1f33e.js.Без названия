define(["require","exports","OK/react-tag-loader","OK/webapi","OK/pms!loginPopupConfig","OK/AuthLoginPopupEventBuses","./AuthTypes","OK/utils/parseJsonConf"],(function(require,e,t,n,o,a,i,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.closeIfOpened=e.layerAlreadyOpened=e.openLayer=e.openInternal=e.open=e.AuthLoginPopup=void 0;var p,u,g,l="auth-login-popup",s=o,d=new Map;function c(e){if(null==this?void 0:this.popupTriggeringAction)return{popupTriggeringAction:this.popupTriggeringAction,msgParams:this.msgParams};var t=e.getAttribute("data-trigger-action");return t&&!(t in i.AuthTriggerAction)&&(console.error("Wrong trigger action value! But be aware that the key is checking! Current value: ",t),t=null),{popupTriggeringAction:t,msgParams:(0,r.parseJsonConf)(e,"data-msg-params")}}e.AuthLoginPopup={activate:function(t){var n=function(e,t,n){return{el:e,popupTriggeringAction:t.popupTriggeringAction,msgParams:t.msgParams,clickHandler:null,stopPropagation:n}}(t,c(t),"true"===t.getAttribute("data-stop-propagation"));d.set(t,n),n.clickHandler=this.onClick.bind(n),t.addEventListener("click",n.clickHandler),e.AuthLoginPopup.refreshPopupNode()},deactivate:function(e){e.removeEventListener("click",d.get(e).clickHandler),d.delete(e)},layerAlreadyOpened:function(){var e=document.getElementsByTagName(l);return e&&e.length&&e[0].hasChildNodes()},closeIfOpened:function(){try{e.AuthLoginPopup.layerAlreadyOpened()&&(null==g||g.close())}catch(e){}},open:function(t){if(t.href){if(t.href!==u)return void n.invoke("login/addLoginIntentForHref",{href:t.href}).then((function(n){t.loginIntent=n,u=t.href,p=n,e.AuthLoginPopup.layerAlreadyOpened()||e.AuthLoginPopup.openInternal(t)}));t.loginIntent=p}e.AuthLoginPopup.openInternal(t)},openInternal:function(n){if(delete n.href,g&&!g.parentElement&&e.AuthLoginPopup.refreshPopupNode(),(null==g?void 0:g.parentElement)&&!s.isAuthPopupRedesign2023)g.open(n);else{var o,i=document.getElementById("hook_Block_LoginPopupReact");o=n.loginIntent?{socialButtons:{commandName:"login/getSocialLoginButtons",commandParams:{loginIntentToken:n.loginIntent}}}:{socialButtons:"login/getSocialLoginButtons"},s.isAuthPopupRedesign2023?a.AUTH_LOGIN_POPUP_OPEN.emit(Object.assign(Object.assign({},n),{goBackAfterLogin:!0}),this):t.getTag(l,o,i).then((function(e){(g=e).open(n)}))}},openLayer:function(t){if(!e.AuthLoginPopup.layerAlreadyOpened()){var n=function(e){var t="true"===e.getAttribute("data-go-back-after-login"),n="false"!==e.getAttribute("data-save-search-attrs"),o=t?A():h(e)||A();return n?o:o.split("?")[0]}(t),o=t.getAttribute("data-login-layer-text")||"",a=t.getAttribute("data-login-layer-registration-token")||"",i=t.getAttribute("data-login-layer-social-api-provider")||"",p=t.getAttribute("data-additional-stat-location")||"",u=t.getAttribute("data-show-close-as-button")||!1,g="true"===t.getAttribute("data-landing-page"),l=t.getAttribute("data-login-show-profiles"),s="true"===l||null===l,d=(0,r.parseJsonConf)(t,"data-login-layer-header-image-conf"),f="true"===t.getAttribute("data-is-hobbyshow-landing"),P="true"===t.getAttribute("data-login-hide-footer"),m=(0,r.parseJsonConf)(t,"data-state-params"),L=t.getAttribute("data-login-intent"),y=Object.assign({href:n,text:o,showProfiles:s,hideFooter:P,registrationToken:a,socialApiProvider:i,landing:g,contactOwnerExists:!1,contactOwnerRecoveryRequired:!1,showCloseAsButton:u,headerImage:d,additionalStatLocation:p,isHobbyShowLanding:f,stateParams:m,loginIntent:L},c(t));e.AuthLoginPopup.open(y)}},refreshPopupNode:function(){g=document.querySelector(l)},onClick:function(t){var n;t.preventDefault();for(var o=t.target;o&&"AuthLoginPopup"!==o.getAttribute("data-module");)o=o.parentElement;o&&((null===(n=d.get(o))||void 0===n?void 0:n.stopPropagation)&&(t.stopPropagation(),t.stopImmediatePropagation()),e.AuthLoginPopup.openLayer.call(this,o))}},e.open=e.AuthLoginPopup.open,e.openInternal=e.AuthLoginPopup.openInternal,e.openLayer=e.AuthLoginPopup.openLayer,e.layerAlreadyOpened=e.AuthLoginPopup.layerAlreadyOpened,e.closeIfOpened=e.AuthLoginPopup.closeIfOpened,e.default=e.AuthLoginPopup;var h=function(e){var t=e.getAttribute("data-href")||e.getAttribute("href")||"";return"#"===t&&(t=""),t},A=function(){return window.location.pathname+window.location.search}}));
//# sourceMappingURL=/res/source-maps/js/app/AuthLoginPopup.js.map