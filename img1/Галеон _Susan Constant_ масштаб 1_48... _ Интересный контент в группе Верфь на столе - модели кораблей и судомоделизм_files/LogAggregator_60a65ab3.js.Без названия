define(["OK/logger","OK/cookie"],(function(n,t){"use strict";var e,r,u,o,i="garbagelog",l=!1,a=!1;function c(t){var e=n.repository.getRequestData();e&&OK.sendBeacon("/gwtlog",e)}function d(){l?!0:(!1,c())}function f(n){var t=n.indexOf(".");return-1===t?n:n.substring(0,t)}function s(t,e,r,l,s,g,v){(function(t){if(!t)return!1;var e=f(t);return u.indexOf(e)>=0||(u.indexOf(i)>=0&&n.success(i,e),!1)})(t)&&(l&&!function(n){if(!n)return!1;var t=f(n),e=u.indexOf(t);return e>=0&&e<o}(t)&&(l=null),e?n.repository.addLog(t,parseInt(e,10),r,l,null,v[0],v[1]):n.repository.addLog(t,null,r,l,null,v[0],v[1]),s||a?c():g&&d())}function g(n,t,e,r,u){s(n,null,t,e,r,!1,u)}function v(n,e,r,u){var o;((o=t.readCookie("dme"))&&"true"===o.toLowerCase()||document.getElementById("__gwtd__m"))&&window.alert("Fatal Error '"+n+"'\nplace='"+r+"'\nerror name='"+u+"'\nCLOB='"+e+"'"),g(n,null,e,!0,[r,u])}function b(t){var e=parseInt(t.getAttribute("data-interval"),10)||1e3,i="true"===t.getAttribute("data-onbeforeunload");o=parseInt(t.getAttribute("data-clobslen"),10)||0,u=JSON.parse(t.firstChild.textContent),n.error=function(n,t){g("error","",null,!1,[t,n])},n.success=function(n,t,e){!function(n,t){s(n,null,null,null,!1,!1,t)}(n,[t,e])},n.force=function(n,t,e){!function(n,t){s(n,null,null,null,!1,!0,t)}(n,[t,e])},n.duration=function(n,t,e,r){!function(n,t,e){s(n,t,null,null,!1,!1,e)}(n,t,[e,r])},n.clob=v,n.raw=function(n,t,e,r){g(n,null,t,!1,[e,r])},n.replayQueue(),r=setInterval(d,e),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&c()})),i&&window.addEventListener("beforeunload",(function(){a=!0,c()}),!1)}return{activate:function(n){e||(b(n),e=!0)},deactivate:function(){r&&(clearInterval(r),r=null)}}}));
//# sourceMappingURL=/res/source-maps/js/app/LogAggregator.js.map