define(["module","OK/logger","OK/capture"],(function(e,t,r){"use strict";var a=e.config().baseUrl||"/res/react",n=["REACT/vendors","REACT/core","OK/pts","OK/pms","OK/webapi","OK/css-loader","OK/LazyIconsCache"],o="app-block",i={INIT:o+":init",ACTIVATE:o+":activate",DEACTIVATE:o+":deactivate",ERROR:o+":error",REACT_ERROR:o+":react-error",LOG:o+":log",READY:o+":ready"},s=o+"-inited",c=function(){this.element=null,this.tagName="",this.appModule=null};function u(e){for(var t=(e||"").split(","),r=[],a=0,n=t.length;a<n;a++)t[a]&&r.push(t[a].trim());return r}function d(t){return require(t.modules,t.resolve,(function(r){var a=r.requireModules,n=e.config().retryRequireLoad||0,o=t.step||1,i=o<=n,s=i||e.config().alwaysUndefOnError;if(a&&s&&a.forEach((function(e){requirejs.undef(e)})),!a||!i)return f(t.tagName,t.error,function(e){var t=e.originalError||e;return{message:t.message||e.message||"",requireType:e.requireType,requireModules:e.requireModules,stack:t.stack||e.stack||""}}(r)),void t.reject(r);d(Object.assign({},t,{modules:a,step:o+1}))}))}function l(e){return a+"/"+e}function f(e,r,a){console.error(e,r,a),OK.Tracer.error(new Error('An error occurred in the "'+e+'" component'),{code:r,data:JSON.stringify(a)});var n=a;"object"==typeof a&&(n=Object.keys(a).map((function(e){var t=a[e];return e+"="+("string"==typeof t?t:JSON.stringify(t))})).join("\n")),t.clob("react-error",n,e,r)}function m(){return Math.floor(performance.now())}function p(e){return e<10?"0":e>5e3?"5000":(Math.floor(e)+"").split("").map((function(e,t){return t?"0":e})).join("")}return c.prototype.activate=function(e){this.element=e,this.tagName=e.tagName.toLowerCase(),this.activateStartTime=m();var t=this;if(!e)return Promise.reject(new Error("Element is not provided"));var r=e.getAttribute("data-react"),a=e.getAttribute("data-css"),o=u(e.getAttribute("data-l10n")),i=u(e.getAttribute("data-cfg")),s=u(e.getAttribute("data-require-modules"));return r?function(e,t,r,a,o,i){var s=["OK/react-loader!"+l(t)];r&&s.push("OK/css-loader!"+l(r));a.length>0&&s.push("OK/pts!"+a.join(","));o.forEach((function(e){s.push("OK/pms!"+e)}));var c=n.concat(i||[]);return new Promise((function(t,r){d({tagName:e,reject:r,modules:c,error:"react-loading-libs-error",resolve:function(){d({tagName:e,reject:r,modules:s,error:"react-loading-dependencies-error",resolve:t})}})}))}(t.tagName,r,a,o,i,s).then((function(e){try{return t.appModule=e,t.render()}catch(e){throw f(t.tagName,"react-loader-render-func-error",{message:e.message,stack:e.stack}),e}})):Promise.reject(new Error("Module path not valid"))},c.prototype.deactivate=function(){this.appModule&&this.appModule.tags[this.tagName].destroy(this.element)},c.prototype.render=function(){var e=this.element,a=function(e){var t={};if(e.hasAttributes())for(var r=e.attributes,a=r.length-1;a>=0;a--)t[r[a].name]=r[a].value;return t}(e),n=function(e){var t,r,a,n={},o=[],i=[];for(Array.from(e.childNodes).forEach((function(t){if(1===t.nodeType){var r,a=[],n=t.tagName.toLowerCase();"template"===n?(a=Array.from(((r=t).content||r).children||[]),i.push(t)):a="ui-part"===n?[t]:Array.from(function(e){return e.getElementsByTagName("ui-part")}(e)),o=o.concat(a)}})),r=o.length-1;r>=0;r--)"ui-part"===(t=o[r]).tagName.toLowerCase()&&(a=t.innerHTML)&&(n[t.getAttribute("data-part-id")]=a);return i.forEach((function(t){e.removeChild(t)})),n}(e),o=this.tagName;!function(e){var t=Array.from(e.getElementsByTagName("span")),r=require("OK/LazyIconsCache");t.forEach((function(e){if(e.hasChildNodes()&&"svg"===e.firstChild.tagName){var t=e.getAttribute("data-icon-name");if(t){var a=r.getInstance(t);a.html||a.makeNode(e.innerHTML)}}}))}(e),e.addEventListener(i.INIT,(function(t){Object.assign(e,t.detail),e.setAttribute(s,"true"),e.dispatchEvent(new CustomEvent(i.READY,{bubbles:!1,cancelable:!1}))})),e.addEventListener(i.ACTIVATE,(function(e){r.activate(e.detail.element)})),e.addEventListener(i.DEACTIVATE,(function(e){var t=e.detail.element;r.deactivateOnlyElement?r.deactivateOnlyElement(t):r.deactivate(t)})),e.addEventListener(i.ERROR,(function(e){console.error(o,e.detail),t.error(o,e.detail)})),e.addEventListener(i.REACT_ERROR,(function(e){f(o,e.detail.code,e.detail.data)})),e.addEventListener(i.LOG,(function(e){t[e.detail.type].apply(t,e.detail.params||[])}));var c=this.appModule.tags[o];try{t.success("react-render-try",o,p(m()-this.activateStartTime)),c.render({tagName:o,attrs:a,parts:n,node:e}),t.success("react-render-success",o,p(m()-this.activateStartTime))}catch(e){f(o,"react-first-render-error",{message:e.message,stack:e.stack})}},c.onAppReady=function(e){return new Promise((function(t){e.getAttribute(s)?t(e):e.addEventListener(i.READY,(function(){t(e)}))}))},c.load=function(e,t,r){if(!document.head&&!document.body)throw new Error("DOM must be loaded");t([e],r,(function(e){r.error&&r.error(e)}))},c}));
//# sourceMappingURL=/res/source-maps/js/app/react-loader.js.map