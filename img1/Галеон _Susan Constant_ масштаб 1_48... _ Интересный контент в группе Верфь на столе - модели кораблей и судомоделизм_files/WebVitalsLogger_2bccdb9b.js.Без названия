define(["require","exports","web-vitals","OK/webapi","OK/utils/debounce"],(function(require,t,e,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logger=void 0;var s=function(t,e){var n="LCP"===e?"renderTime":"duration";return t.sort((function(t,e){return r(t,e,n)})),t[0]},r=function(t,e,n){return t[n]<e[n]?1:t[n]>e[n]?-1:0},a=function(t,e,n,o){return{htmlElementsInfo:t,metric:o,value:parseFloat(e.toFixed(3)),url:window.location.pathname,state:OK.state.getCurrentStateId(),rating:n,isForAbMetrics:!0}},i=function(t){console.log("Web Vitals report:",t)},l=function(){var t=this;this.reportsToSend=[],this.worstClsReports=[],this.worstInpReports=[],this.sendReports=o(1e3,(function(){n.invoke("web-vitals/send",{reports:t.reportsToSend}),t.reportsToSend=[]}))};l.prototype.addWorstReport=function(t,e,n,o){var s="CLS"===n?this.worstClsReports:this.worstInpReports,r=a(o,t,e,n);this.consoleLogsEnabled&&i(r),s.length&&(s[s.length-1].isForAbMetrics=!1),s.push(r),s.length>this.reportsCapacityMap[n]&&s.shift()},l.prototype.initiateSendReports=function(t){var e;t.length&&((e=this.reportsToSend).push.apply(e,t),this.sendReports())},l.prototype.activate=function(t,n,o){var r=this;void 0===n&&(n=5),void 0===o&&(o=5),this.consoleLogsEnabled=t,this.reportsCapacityMap={INP:n,CLS:o},e.onLCP((function(t){var e=s(t.entries,t.name).element,n=a(e?[{tag:e.localName,className:e.className}]:null,t.value,t.rating,"LCP");r.consoleLogsEnabled&&i(n),r.initiateSendReports([n])})),e.onFID((function(t){var e=t.entries[0].target,n=a(e?[{tag:e.localName,className:e.className}]:null,t.value,t.rating,"FID");r.consoleLogsEnabled&&i(n),r.initiateSendReports([n])})),e.onCLS((function(t){if(t.value){var e=new Set,n=t.entries.reduce((function(t,n){return n.sources.forEach((function(n){if(n.node){var o=n.node,s=o.className,r=o.localName,a=r+s;e.has(a)||(t.push({className:s,tag:r}),e.add(a))}})),t}),[]);r.addWorstReport(t.value,t.rating,"CLS",n)}}),{reportAllChanges:!0}),e.onINP((function(t){var e=s(t.entries,t.name).target;r.addWorstReport(t.value,t.rating,"INP",e?[{tag:e.localName,className:e.className}]:null)}),{reportAllChanges:!0}),document.addEventListener("visibilitychange",(function(){if("hidden"===document.visibilityState){var t=[];r.worstClsReports.length&&(t.push.apply(t,r.worstClsReports),r.worstClsReports=[]),r.worstInpReports.length&&(t.push.apply(t,r.worstInpReports),r.worstInpReports=[]),r.initiateSendReports(t)}}))},t.logger=new l}));
//# sourceMappingURL=/res/source-maps/js/app/WebVitalsLogger.js.map